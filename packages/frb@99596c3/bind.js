function bind(e,i,t){t.target=e,t.targetPath=i;var s=t.source=t.source||e,a=t["<-"]||t["<->"]||"",u=t.twoWay="<->"in t;t.sourcePath=a,t.value;var n=t.parameters=t.parameters||s,l=t.document,r=t.components,o=t.trace,c=t.sourceScope=new Scope(s);c.parameters=n,c.document=l,c.components=r;var m=t.targetScope=new Scope(e);if(m.parameters=n,m.document=l,m.components=r,t.converter){var d=t.converter;d.convert&&(t.convert=d.convert.bind(d)),d.revert&&(t.revert=d.revert.bind(d))}else if(t.reverter){var p=t.reverter;p.convert&&(t.revert=p.convert.bind(p)),p.revert&&(t.convert=p.revert.bind(p))}var v=t.convert,g=t.revert,h=t.sourceSyntax=parse(a),b=t.targetSyntax=parse(i),f=solve(b,h);if(b=f[0],h=f[1],u&&"rangeContent"===b.type)return bindRangeContent(m,b.args[0],c,h,v,g,t,o?{sourcePath:stringify(h),targetPath:stringify(b.args[0])}:null);o&&console.log("DEFINE BINDING",i,"<-",a,e);var q=bindOneWay(m,b,c,h,v,t,o),f=solve(h,b);h=f[0],b=f[1];var S=Function.noop;return u&&(o&&console.log("DEFINE BINDING",i,"->",a,s),S=bindOneWay(c,h,m,b,g,t,o)),function(){q(),S()}}function bindOneWay(e,i,t,s,a,u,n){var l=compileObserver(s);a&&(l=Observers.makeConverterObserver(l,a,t));var r=compileBinder(i);return r(l,t,e,u,n?{sourcePath:stringify(s),targetPath:stringify(i)}:null)}function bindRangeContent(e,i,t,s,a,u,n,l){function r(e,i,t){p||(p=!0,l&&console.log("RANGE CONTENT PROPAGATED",l.targetPath,"<-",l.sourcePath,"PLUS",e,"MINUS",i,"AT",t),m.swap(t,i.length,e),p=!1)}function o(e,i,t){p||(p=!0,l&&console.log("RANGE CONTENT PROPAGATED",l.targetPath,"->",l.sourcePath,"PLUS",e,"MINUS",i,"AT",t),d.swap(t,i.length,e),p=!1)}function c(){if(d!==m){l&&console.log("RANGE CONTENT BOUND",l.targetPath,"<->",l.sourcePath),p=!0;var i=observeRangeChange(d,r,t),s=observeRangeChange(m,o,e);return p=!1,function(){l&&console.log("RANGE CONTENT UNBOUND",l.targetPath,"<->",l.sourcePath),i(),s()}}}var m,d,p,v=compileObserver(s),g=compileObserver(i),h=compileAssigner(s),b=compileAssigner(i),f=Function.noop;p=!0;var q=g(function(e){f(),f=Function.noop,l&&console.log("RANGE CONTENT TARGET",l.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(m=e,d&&m?(l&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",l.targetPath,"->",l.sourcePath,"WITH",m),p=!0,d.swap(0,d.length,m),p=!1,f=c()):d||p||(l&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",l.targetPath,"<-",tarce.sourcePath,"WITH",d),h(m.clone(),t)))},e);p=!1;var S=v(function(i){f(),f=Function.noop,l&&console.log("RANGE CONTENT SOURCE",l.sourcePath,"SET TO",i),i&&i.addRangeChangeListener&&(d=i,m&&d?(l&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",l.targetPath,"<-",l.sourcePath,"WITH",d),p=!0,m.swap(0,m.length,d),p=!1,f=c()):m||b(d.clone(),e))},t);return m||d||h([],t),function(){f(),q(),S()}}var parse=require("./parse"),solve=require("./algebra"),stringify=require("./stringify"),compileObserver=require("./compile-observer"),compileBinder=require("./compile-binder"),compileAssigner=require("./compile-assigner"),Observers=require("./observers"),observeRangeChange=Observers.observeRangeChange,Binders=require("./binders"),Scope=require("./scope");module.exports=bind;