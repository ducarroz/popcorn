function getStackTrace(){return Error("").stack.replace(/^.*\n.*\n/,"\n")}function bindProperty(e,i,t,s,a,u){return t(autoCancelPrevious(function(t){if(!a.isActive)try{a.isActive=!0,u&&console.log("SET",u.targetPath,"TO",t,"ON",e,"BECAUSE",u.sourcePath,getStackTrace()),Array.isArray(e)&&i>>>0===i?e.set(i,t):e[i]=t}finally{a.isActive=!1}}),s)}function makePropertyBinder(e,i){return function(t,s,a,u,n){return i(autoCancelPrevious(function(i){return null!=i?e(autoCancelPrevious(function(e){return null!=e?e.bindProperty?e.bindProperty(i,t,s,u,n):_bindProperty(e,i,t,s,u,n):void 0}),a):void 0}),a)}}function bindGet(e,i,t,s,a,u){return t(autoCancelPrevious(function(t){if(!a.isActive)try{a.isActive=!0,u&&console.log("SET FOR KEY",i,"TO",t,"ON",e,"BECAUSE",u.sourcePath,getStackTrace()),e.set(i,t)}finally{a.isActive=!1}}),s)}function makeGetBinder(e,i){return function(t,s,a,u,n){return e(autoCancelPrevious(function(e){return e?i(autoCancelPrevious(function(i){return null!=i?_bindGet(e,i,t,s,u,n):void 0}),a):void 0}),a)}}function makeHasBinder(e,i){return function(t,s,a,u,n){return e(autoCancelPrevious(function(e){return e?i(autoCancelPrevious(function(i){return null!=i?t(autoCancelPrevious(function(t){if(t)(e.has||e.contains).call(e,i)||(n&&console.log("ADD",i,"TO",n.targetPath,"BECAUSE",n.sourcePath,getStackTrace()),e.add(i));else for(;(e.has||e.contains).call(e,i);)n&&console.log("REMOVE",i,"FROM",n.targetPath,"BECAUSE",n.sourcePath,getStackTrace()),(e.remove||e["delete"]).call(e,i)}),s):void 0}),a):void 0}),a)}}function makeEqualityBinder(e,i){return function(t,s,a,u,n){return t(autoCancelPrevious(function(t){return t?(n&&console.log("BIND",n.targetPath,"TO",n.sourcePath,getStackTrace()),e(i,s,s,u,n),function(){n&&console.log("UNBIND",n.targetPath,"FROM",n.sourcePath,getStackTrace())}):void 0}),a)}}function makeEveryBlockBinder(e,i,t){return function(s,a,u,n,l){return s(autoCancelPrevious(function(s){return s?e(autoCancelPrevious(function(e){function s(e,s,r){a.swap(r,s.length,e.map(function(e){var s=u.nest(e);return i(t,s,s,n,l)}))}if(e){var a=[],r=observeRangeChange(e,s,u);return function(){cancelEach(a),r()}}}),u):void 0}),a)}}function makeAndBinder(e,i,t,s,a,u){var n=makeNotObserver(s),l=makeAndObserver(t,n);return function(t,s,n,r,o){return t(autoCancelPrevious(function(t){if(null!=t){if(t){var s=e(a,trueScope,n,r,o),c=i(u,trueScope,n,r,o);return function(){s(),c()}}return e(l,n,n,r,o)}}),s)}}function makeOrBinder(e,i,t,s,a,u){var n=makeNotObserver(s),l=makeOrObserver(t,n);return function(t,s,n,r,o){return t(autoCancelPrevious(function(t){if(null!=t){if(t)return e(l,n,n,r,o);var s=e(a,falseScope,n,r,o),c=i(u,falseScope,n,r,o);return function(){s(),c()}}}),s)}}function makeConditionalBinder(e,i,t){return function(s,a,u,n,l){return e(autoCancelPrevious(function(e){return null!=e?e?i(s,a,u,n,l):t(s,a,u,n,l):void 0}),a)}}function makeOnlyBinder(e){return function(i,t,s){return e(autoCancelPrevious(function(e){return e?i(autoCancelPrevious(function(i){null!=i&&(e.splice?e.splice(0,e.length,i):e.clear&&e.add&&(e.clear(),e.add(i)))}),t):void 0}),s)}}function makeOneBinder(e){return function(i,t,s){return e(autoCancelPrevious(function(e){return e?i(autoCancelPrevious(function(i){null!=i&&i!==e.one()&&(e.splice?e.splice(0,e.length,i):e.clear&&e.add&&(e.clear(),e.add(i)))}),t):void 0}),s)}}function makeRangeContentBinder(e,i){return function(t,s,a,u,n){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(i){function t(i,t,s){isActive(e)||(n&&console.log("SWAPPING",t,"FOR",i,"AT",s,"ON",n.targetPath,getStackTrace()),e.swap?e.swap(s,t.length,i):e.add&&(e.remove||e["delete"])&&(i.forEach(e.add,e),t.forEach(e.remove||e["delete"],e)))}if(i!==e){if(!i)return e.clear(),void 0;if(i.addRangeChangeListener)return i.addRangeChangeListener(t),t(Array.from(i),Array.from(e),0),once(function(){i.removeRangeChangeListener(t)})}}),s):i(Observers.makeLiteralObserver([]),s,a,u,n)}),a)}}function makeMapContentBinder(e){return function(i,t,s,a,u){return e(autoCancelPrevious(function(e){return e?i(autoCancelPrevious(function(i){function t(i,t){if(!a.isActive)try{a.isActive=!0,void 0===i?(u&&u&&console.log("DELETED",u.targetPath,"FOR KEY",t,"ON",e,"BECAUSE",u.sourcePath,getStackTrace()),Array.isArray(e)?e.splice(t,1):e["delete"](t)):(u&&u&&console.log("SET",u.targetPath,"FOR KEY",t,"TO",i,"ON",e,"BECAUSE",u.sourcePath,getStackTrace()),e.set(t,i))}finally{a.isActive=!1}}return i?(e.clear(),i.forEach(t),i.addMapChangeListener(t)):(e.clear(),void 0)}),t):void 0}),s)}}function makeReversedBinder(e){return function(i,t,s){return e(autoCancelPrevious(function(e){return e?i(autoCancelPrevious(function(i){function t(i,t,s){if(!isActive(e)){var a=e.length-s-t.length;e.swap(a,t.length,i.reversed())}}return i?(i.addRangeChangeListener(t),t(i,e,0),once(function(){i.removeRangeChangeListener(t)})):(e.clear(),void 0)}),t):void 0}),s)}}function makeDefinedBinder(e){return function(i,t,s,a,u){return i(autoCancelPrevious(function(i){return i?Function.noop:e(observeUndefined,t,s,a,u)}),s)}}function makeParentBinder(e){return function(i,t,s,a,u){return s.parent?e(i,t,s.parent,a,u):void 0}}function makeWithBinder(e,i){return function(t,s,a,u,n){return e(autoCancelPrevious(function(e){return null!=e?i(t,s,a.nest(e),u,n):void 0}),a)}}function isActive(e){return e.getRangeChangeDescriptor&&e.getRangeChangeDescriptor().isActive}var Scope=require("./scope"),Observers=require("./observers"),autoCancelPrevious=Observers.autoCancelPrevious,once=Observers.once,observeRangeChange=Observers.observeRangeChange,cancelEach=Observers.cancelEach,makeNotObserver=Observers.makeNotObserver,makeOrObserver=Observers.makeOrObserver,makeAndObserver=Observers.makeAndObserver,observeValue=Observers.observeValue,observeUndefined=Observers.makeLiteralObserver(),trueScope=new Scope(!0),falseScope=new Scope(!1);exports.bindProperty=bindProperty;var _bindProperty=bindProperty;exports.makePropertyBinder=makePropertyBinder,exports.bindGet=bindGet;var _bindGet=bindGet;exports.makeGetBinder=makeGetBinder,exports.makeHasBinder=makeHasBinder,exports.makeEqualityBinder=makeEqualityBinder,exports.makeEveryBlockBinder=makeEveryBlockBinder,exports.makeAndBinder=makeAndBinder,exports.makeOrBinder=makeOrBinder,exports.makeConditionalBinder=makeConditionalBinder,exports.makeOnlyBinder=makeOnlyBinder,exports.makeOneBinder=makeOneBinder,exports.makeRangeContentBinder=makeRangeContentBinder,exports.makeMapContentBinder=makeMapContentBinder,exports.makeReversedBinder=makeReversedBinder,exports.makeDefinedBinder=makeDefinedBinder,exports.makeParentBinder=makeParentBinder,exports.makeWithBinder=makeWithBinder;