montageDefine("99596c3","bind",{dependencies:["./parse","./algebra","./stringify","./compile-observer","./compile-binder","./compile-assigner","./observers","./binders","./scope"],factory:function(e,i,t){function s(e,i,t){t.target=e,t.targetPath=i;var s=t.source=t.source||e,o=t["<-"]||t["<->"]||"",c=t.twoWay="<->"in t;t.sourcePath=o,t.value;var m=t.parameters=t.parameters||s,d=t.document,p=t.components,g=t.trace,h=t.sourceScope=new v(s);h.parameters=m,h.document=d,h.components=p;var b=t.targetScope=new v(e);if(b.parameters=m,b.document=d,b.components=p,t.converter){var f=t.converter;f.convert&&(t.convert=f.convert.bind(f)),f.revert&&(t.revert=f.revert.bind(f))}else if(t.reverter){var q=t.reverter;q.convert&&(t.revert=q.convert.bind(q)),q.revert&&(t.convert=q.revert.bind(q))}var S=t.convert,P=t.revert,y=t.sourceSyntax=n(o),N=t.targetSyntax=n(i),C=l(N,y);if(N=C[0],y=C[1],c&&"rangeContent"===N.type)return u(b,N.args[0],h,y,S,P,t,g?{sourcePath:r(y),targetPath:r(N.args[0])}:null);g&&console.log("DEFINE BINDING",i,"<-",o,e);var D=a(b,N,h,y,S,t,g),C=l(y,N);y=C[0],N=C[1];var M=Function.noop;return c&&(g&&console.log("DEFINE BINDING",i,"->",o,s),M=a(h,y,b,N,P,t,g)),function(){D(),M()}}function a(e,i,t,s,a,u,n){var l=o(s);a&&(l=d.makeConverterObserver(l,a,t));var m=c(i);return m(l,t,e,u,n?{sourcePath:r(s),targetPath:r(i)}:null)}function u(e,i,t,s,a,u,n,l){function r(e,i,t){h||(h=!0,l&&console.log("RANGE CONTENT PROPAGATED",l.targetPath,"<-",l.sourcePath,"PLUS",e,"MINUS",i,"AT",t),v.swap(t,i.length,e),h=!1)}function c(e,i,t){h||(h=!0,l&&console.log("RANGE CONTENT PROPAGATED",l.targetPath,"->",l.sourcePath,"PLUS",e,"MINUS",i,"AT",t),g.swap(t,i.length,e),h=!1)}function d(){if(g!==v){l&&console.log("RANGE CONTENT BOUND",l.targetPath,"<->",l.sourcePath),h=!0;var i=p(g,r,t),s=p(v,c,e);return h=!1,function(){l&&console.log("RANGE CONTENT UNBOUND",l.targetPath,"<->",l.sourcePath),i(),s()}}}var v,g,h,b=o(s),f=o(i),q=m(s),S=m(i),P=Function.noop;h=!0;var y=f(function(e){P(),P=Function.noop,l&&console.log("RANGE CONTENT TARGET",l.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(v=e,g&&v?(l&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",l.targetPath,"->",l.sourcePath,"WITH",v),h=!0,g.swap(0,g.length,v),h=!1,P=d()):g||h||(l&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",l.targetPath,"<-",tarce.sourcePath,"WITH",g),q(v.clone(),t)))},e);h=!1;var N=b(function(i){P(),P=Function.noop,l&&console.log("RANGE CONTENT SOURCE",l.sourcePath,"SET TO",i),i&&i.addRangeChangeListener&&(g=i,v&&g?(l&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",l.targetPath,"<-",l.sourcePath,"WITH",g),h=!0,v.swap(0,v.length,g),h=!1,P=d()):v||S(g.clone(),e))},t);return v||g||q([],t),function(){P(),y(),N()}}var n=e("./parse"),l=e("./algebra"),r=e("./stringify"),o=e("./compile-observer"),c=e("./compile-binder"),m=e("./compile-assigner"),d=e("./observers"),p=d.observeRangeChange;e("./binders");var v=e("./scope");t.exports=s}});